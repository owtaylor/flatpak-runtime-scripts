compose:
    modules:
        - flatpak-runtime:f34
flatpak:
    id: org.fedoraproject.Platform
    name: f34/flatpak-runtime
    branch: f34
    sdk: org.fedoraproject.Sdk
    finish-args: >
        --env=GI_TYPELIB_PATH=/app/lib64/girepository-1.0
        --env=GST_PLUGIN_SYSTEM_PATH=/app/lib64/gstreamer-1.0:/usr/lib64/gstreamer-1.0
        --env=LD_LIBRARY_PATH=/app/lib64
        --env=XDG_DATA_DIRS=/app/share:/usr/share:/usr/share/runtime/share:/run/host/share
    # For applications, appstream-compose is run automatically along with other processing
    # of the tree. For runtimes, we have to run it manually. flatpak-module-tools local
    # builds have issues if the cleanup script outputs to stdout, hence the 1>&2
    # redirection.
    cleanup-commands: |
        appstream-compose --verbose   \
            --prefix=/usr             \
            --basename=org.fedoraproject.Platform \
            --origin=flatpak          \
            org.fedoraproject.Platform 1>&2

        mv -f /usr/bin/flatpak-xdg-email /usr/bin/xdg-email
        mv -f /usr/bin/flatpak-xdg-open /usr/bin/xdg-open

        rm -rf /etc/flatpak-builder/

        touch -d @0 /usr/share/fonts /usr/share/fonts/*
        fc-cache -rs

# We don't have a way to make the set of included RPMs specific to a particular
# architecture, and some packages are missing on other platforms
platforms:
    only: x86_64
